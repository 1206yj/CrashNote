[TOC]

#二、彩色图像处理

## 1. 颜色的特性

- 亮度：光的振幅，物体表面的反光率。实际上不能度量，色彩的强度（人眼对亮度的敏感 > 色彩）
- 色调：人感知的主要颜色
  补色：在色环上，与一个色调直接相对的另一端，用于增强图像暗区细节
- 饱和度：颜色的纯度，一种颜色混合白光的比例（100% 是无白光混合），物体反射的颜色，**饱和度高了色彩会鲜亮**
- 色度：色调 + 饱和度
  ​

## 2. 色彩模型

### 2.1 RGB 色彩模型

特点：适合色彩生成，适合硬件设备对于色彩的实现

加色混色模型：颜色混在一起亮度增大，**R**ed、**G**reen、**B**lue 三种颜色的取值范围是 [0, 255]

![](/Users/sun/Documents/CrushNote/DigitalImageProcessing/images/modelRGB.jpg)

### 2.2 CMY 和 CMYK 色彩模型 	 

特点：适合色彩生成，适合硬件设备对于色彩的实现

减色混色模型：颜色混在一起亮度降低，**C**yan (青)、**M**agenta (品红)、**Y**ellow(黄)、Blac**K**(黑)，加入黑色是因为打印时由品红、黄、青构成的黑色不够纯粹

![](/Users/sun/Documents/CrushNote/DigitalImageProcessing/images/modelCMYK.png)



### 2.3 HSL 和 HSV 色彩模型 

特点：适合色彩描述、电脑绘画、图像算法的处理，人能观察的色彩并不是由 RGB 三种颜色混合而成，而是取决于颜色的亮度、色调、饱和度

**H**ue：色相，决定什么颜色，对应 *红橙黄绿青蓝紫 红* 首尾相接的色相环值，取值范围 [0, 360)
**S**aturation：饱和度，决定颜色浓淡，一种颜色混合白光的比例（100% 是无白光混合），物体反射的颜色，**饱和度高了色彩会鲜亮**
**L**ightness/**L**uminance/**I**ntensity：亮度，光的振幅，物体表面的反光率
**V**alue/Brightness：明度，人们所感知到的色彩明暗度

明度和亮度：都决定照射在颜色上的白光有多亮，亮度与颜色的辐射能量有关，但能量高的颜色不一定明度高。例，蓝色的能量很高，但其明度却低

![](/Users/sun/Documents/CrushNote/DigitalImageProcessing/images/modelHSLV.png)



### 2.3 YUV 和 YCbCr 色彩模型

特点：适合电视系统，数码摄影点色彩生成和传输

- YUV：Y (亮度)、UV (色度)，欧洲电视系统色彩模型 PAL 制式 
- YCbCr：Y (亮度)、Cb (蓝色色度)、Cr (红色色度)，**YUV 的压缩和偏移版本**

## 3. 色彩模型间的互相转换
### 3.1 RGB 与 HSL 

**RGB 转 HSL**
- 公式：
  如果 R = G = B 时，颜色是非彩色的，H (色相) 无定义，H = S = 0
  max 是 R、G、B 中的最大值
  min 是 R、G、B 中的最小值
  ​
  $$
  \begin{aligned}

  H &= 
  \begin{cases}
  0, &\text{if max = min}\\
  60 \times {G - B \over max - min} + 0, &\text{if max = R  and G $\geq$ B} \\
  60 \times {G - B \over max - min} + 360, &\text{if max = R  and G $\lt$ B}\\
  60 \times {B - R \over max - min} + 120, &\text{if max = G}\\
  60 \times {R - G \over max - min} + 240, &\text{if max = B} \\
  \end{cases} \\\\
  L &= \frac 12(max + min) \\\\
  S & = 
  \begin{cases}
  0 , &\text{if max = min or L = 0}\\
  {max - min \over max + min} = {max - min \over 2L} , &\text{if $0 \lt L \leq \frac 12$}\\
  {max - min \over 2 - (max + min)} = {max - min \over 2 - 2L}  , &\text{if $L \gt \frac 12$}
  \end{cases} 
  \end{aligned}
  $$
  ​

- 代码：

  ```c
  // GLSL
  vec3 RGBToHSL(vec3 color) {
      float min = min(min(color.r, color.g), color.b);
      float max = max(max(color.r, color.g), color.b);
      float sum = max + min;
      float range = max - min;
      
  	// Luminance = 0.5 * sum;
      vec3 hsl = vec3(0.0, 0.0, 0.5 * sum);
   
      if (!range) return hsl; // R = G = B, 颜色是非彩色的 S = 0，这是色相无定义 H = 0

      // Saturation
      // Optimize
      // hsl.y = mix(range / (2.0 - sum), range / sum, step(hsl.z, 0.5));
      hsl.y = hsl.z < 0.5 ? range / sum : range / (2.0 - sum);
      
      // Hue 原来范围是 [0, 360), 这里默认输入的范围是 [0, 1]
      /** Optimize 
          vec3 comp;
          comp.rg = vec2(equal(rgb.rg, vec2(max)));
          float invertR = 1.0 - comp.r;       // 0 or 1
          comp.g *= invertR;                  // g = invertR * g
          comp.b  = invertR * (1.0 - comp.g); // b = invertR * invertG
          hsl.x = dot(comp, vec3((color.g - color.b) / range, (color.b - color.r) / range + 2.0, (color.r - color.g) / range + 4.0));
          hsl.x /= 6.0;
          hsl.x += step(hsl.x, 0.0) * 1.0;
      */
      if (color.r == max)
          hsl.x = (color.g - color.b) / range / 6.0; 
      else if (color.g == max)
          hsl.x = (2.0 + (color.b - color.r) / range) / 6.0; 
      else if (color.b == max)
          hsl.x = (4.0 + (color.r - color.g) / range) / 6.0; 

      if (hsl.x < 0.0)
          hsl.x += 1.0; 
      else if (hsl.x > 1.0)
          hsl.x -= 1.0; 
      
      return hsl;
  }
  ```

**HSL 转 RGB**
- 公式：
  如果 S (饱和度) = 0，则颜色是非彩色的。H (色相)无意义， R = G = B = L (亮度)
  如果 S (饱和度) !=0，有如下公式
  这里 H 的范围是 [0, 1]
  $$
  \begin{aligned}
  temp1 &=
  \begin{cases}
  L \times (1 + S) , &\text{if $L \lt \frac 12$}\\
  L + S - (L \times S) , &\text{if $L \geq \frac 12$}
  \end{cases}\\
  temp2 &= 2 \times L - temp1\\
  R &= H + \frac 13 \\
  G &= H \\
  B &= \\
  \end{aligned}
  $$

- 代码：
```c
// GLSL
```

### 3.2 RGB 与 HSV 



### 3.3 RGB 与 YUV 

